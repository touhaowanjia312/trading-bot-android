# 🤖 Telegram交易跟单机器人

一个功能完整的Telegram交易信号跟单系统，支持自动解析交易信号并在Bitget交易所执行交易。

## 📋 目录

- [功能特性](#功能特性)
- [系统架构](#系统架构)
- [安装配置](#安装配置)
- [使用说明](#使用说明)
- [交易功能](#交易功能)
- [风险管理](#风险管理)
- [配置说明](#配置说明)
- [故障排除](#故障排除)
- [更新日志](#更新日志)

## 🚀 功能特性

### 核心功能
- **实时信号监控**: 监控指定Telegram群组的交易信号
- **智能信号解析**: 支持多种信号格式的自动解析
- **自动交易执行**: 在Bitget交易所自动执行交易
- **图形化界面**: 基于Tkinter的友好GUI界面
- **实时日志显示**: 所有操作实时显示在界面中

### 交易功能
- **开仓交易**: 自动解析信号并开仓
- **自动止损**: 开仓后自动设置7U亏损止损
- **第一止盈**: 达到目标价格时自动50%止盈
- **保本止损**: 第一止盈后自动设置保本止损
- **多持仓管理**: 智能匹配不同币种的交易信号

### 风险管理
- **仓位控制**: 可配置的默认交易金额和杠杆
- **止损保护**: 自动止损机制防止大额亏损
- **价格监控**: 实时监控价格变化
- **异常处理**: 完善的错误处理和重试机制

## 🏗️ 系统架构

```
project1/
├── gui_trading_bot.py          # 主程序入口（GUI版本）
├── src/                        # 核心模块
│   ├── trading/               # 交易相关模块
│   │   ├── bitget_client.py   # Bitget API客户端
│   │   └── signal_parser.py   # 信号解析器
│   ├── telegram/              # Telegram相关模块
│   │   ├── auth.py           # 认证模块
│   │   └── monitor.py        # 消息监控
│   └── utils/                # 工具模块
│       ├── config.py         # 配置管理
│       └── logger.py         # 日志系统
├── config/                   # 配置文件
├── data/                     # 数据目录
│   └── logs/                # 日志文件
└── requirements.txt         # 依赖包列表
```

## 🛠️ 安装配置

### 环境要求
- Python 3.8+
- Windows 10/11 (主要测试环境)
- 稳定的网络连接

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd project1
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置环境变量**
   
   创建 `.env` 文件：
   ```env
   # Telegram API配置
   TELEGRAM_API_ID=your_api_id
   TELEGRAM_API_HASH=your_api_hash
   TELEGRAM_PHONE_NUMBER=+86your_phone
   TELEGRAM_SESSION_NAME=trading_bot
   
   # Bitget API配置
   BITGET_API_KEY=your_bitget_api_key
   BITGET_SECRET_KEY=your_bitget_secret_key
   BITGET_PASSPHRASE=your_bitget_passphrase
   BITGET_SANDBOX=false
   
   # 交易配置
   DEFAULT_TRADE_AMOUNT=3.0
   DEFAULT_LEVERAGE=20
   ```

4. **配置群组监控**
   
   编辑 `groups_config.py`：
   ```python
   def get_monitor_groups():
       return [
           {
               'id': -1001234567890,  # 群组ID
               'name': '交易群组名称',
               'enabled': True
           }
       ]
   ```

## 📖 使用说明

### 启动程序

```bash
python gui_trading_bot.py
```

### 界面说明

- **连接状态**: 显示Telegram和Bitget连接状态
- **实时日志**: 显示所有操作和交易信息
- **控制按钮**: 启动/停止监控功能

### 交易流程

1. **信号接收**: 程序监控指定群组的消息
2. **信号解析**: 自动解析交易信号（币种、方向、金额等）
3. **风险检查**: 验证交易参数和风险控制
4. **执行交易**: 在Bitget交易所执行开仓
5. **设置止损**: 自动设置7U亏损止损
6. **监控价格**: 实时监控价格变化
7. **执行止盈**: 达到第一止盈目标时50%平仓
8. **保本止损**: 设置剩余仓位的保本止损

## 💰 交易功能

### 支持的信号格式

```
# 基础做多信号
BTC 做多
杠杆：20x
金额：5U

# 基础做空信号  
ETH 做空
杠杆：15x
金额：3U

# 第一止盈信号
第一止盈：0.11753

# 止损信号
止损：0.15000
```

### 交易执行逻辑

1. **开仓计算**
   ```
   合约数量 = 保证金金额 / (当前价格 / 杠杆倍数)
   ```

2. **止损价格计算**
   ```
   止损价格 = 开仓价格 ± (7U / (合约数量 * 杠杆倍数))
   ```

3. **第一止盈逻辑**
   - 50%仓位平仓
   - 剩余50%设置保本止损

### 风险控制

- **最大亏损**: 每笔交易最大亏损7U
- **杠杆限制**: 支持1-125倍杠杆
- **仓位管理**: 可配置最大持仓金额
- **异常处理**: 网络异常、API错误自动重试

## ⚙️ 配置说明

### 环境变量配置

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `DEFAULT_TRADE_AMOUNT` | 默认交易金额(U) | 2.0 |
| `DEFAULT_LEVERAGE` | 默认杠杆倍数 | 20 |
| `MAX_POSITION_SIZE` | 最大持仓金额 | 1000.0 |
| `RISK_PERCENTAGE` | 风险百分比 | 2.0 |
| `LOG_LEVEL` | 日志级别 | INFO |

### 群组配置

```python
# groups_config.py
def get_monitor_groups():
    return [
        {
            'id': -1001234567890,      # 群组ID（必需）
            'name': '策略群组',         # 群组名称
            'enabled': True,           # 是否启用监控
            'trade_enabled': True,     # 是否启用交易
            'leverage_override': None, # 杠杆倍数覆盖
            'amount_override': None    # 交易金额覆盖
        }
    ]
```

## 🔧 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证API密钥配置
   - 确认防火墙设置

2. **信号解析失败**
   - 检查信号格式
   - 查看日志详细错误信息
   - 验证群组配置

3. **交易执行失败**
   - 检查账户余额
   - 验证API权限
   - 确认交易对是否存在

4. **日志权限错误**
   - 确保程序有写入权限
   - 检查是否有多个实例运行

### 调试模式

启用详细日志：
```env
LOG_LEVEL=DEBUG
```

查看实时日志：
```bash
tail -f data/logs/trading_bot.log
```

## 📊 性能监控

### 系统状态

- **内存使用**: 通常 50-100MB
- **CPU使用**: 空闲时 <1%，交易时 2-5%
- **网络流量**: 每分钟约 1-5KB

### 监控指标

- 信号接收数量
- 交易执行成功率
- 平均响应时间
- 错误发生频率

## 🔄 更新日志

### v1.0 (2025-10-05)
- ✅ 完整的交易跟单功能
- ✅ 自动止损机制（7U亏损）
- ✅ 第一止盈50%平仓
- ✅ 保本止损设置
- ✅ 多持仓智能匹配
- ✅ GUI界面优化
- ✅ 异常处理完善
- ✅ 日志系统稳定化

### 主要修复
- 🔧 修复自动止损异常处理
- 🔧 解决日志文件权限冲突
- 🔧 改进价格监控逻辑
- 🔧 优化GUI初始化顺序

## ⚠️ 风险提示

1. **投资风险**: 数字货币交易存在高风险，可能导致本金损失
2. **技术风险**: 网络中断、API异常可能影响交易执行
3. **信号风险**: 交易信号可能存在错误或延迟
4. **合规风险**: 请确保在当地法律允许的范围内使用

## 📞 技术支持

- **问题反馈**: 通过GitHub Issues提交
- **功能建议**: 欢迎提出改进建议
- **技术交流**: 详见项目文档

## 📄 许可证

本项目仅供学习和研究使用，请勿用于商业用途。

---

**⚠️ 重要提醒**: 请在充分了解风险的前提下使用本系统，建议先在模拟环境中测试。